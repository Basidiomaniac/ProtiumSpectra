confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
# which lineages are most identifiable when considered as binary (A vs. not A, etc.)
# model, predict lineage
for (lineage in confirmed$population_lineage) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(binary_label) %>%
filter(sample != min(sample))
lineage_test = subserratum %>% group_by(binary_label) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
lda_data <- data.frame(
Species = confirmed$binary_label,
Sample = confirmed$sample,
LD1 = species_predict$x[, 1],
LD2 = species_predict$x[, 2] # Only the first two LDs are used
)
# Store components
lineage_results[[lineage]] = list(
model = lda_model,
predictions = species_predict,
accuracy = accuracy)
urchinplot(lda_data, lda_data, -20, 20, -20, 20)
}
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(binary_label) %>%
filter(sample != min(sample))
lineage_test = subserratum %>% group_by(binary_label) %>%
filter(sample == min(sample))
# which lineages are most identifiable when considered as binary (A vs. not A, etc.)
# model, predict lineage
for (lineage in confirmed$population_lineage) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(binary_label) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(binary_label) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
lda_data <- data.frame(
Species = confirmed$binary_label,
Sample = confirmed$sample,
LD1 = species_predict$x[, 1],
LD2 = species_predict$x[, 2] # Only the first two LDs are used
)
# Store components
lineage_results[[lineage]] = list(
model = lda_model,
predictions = species_predict,
accuracy = accuracy)
urchinplot(lda_data, lda_data, -20, 20, -20, 20)
}
library(MASS)
# which lineages are most identifiable when considered as binary (A vs. not A, etc.)
# model, predict lineage
for (lineage in confirmed$population_lineage) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(binary_label) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(binary_label) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
lda_data <- data.frame(
Species = confirmed$binary_label,
Sample = confirmed$sample,
LD1 = species_predict$x[, 1],
LD2 = species_predict$x[, 2] # Only the first two LDs are used
)
# Store components
lineage_results[[lineage]] = list(
model = lda_model,
predictions = species_predict,
accuracy = accuracy)
urchinplot(lda_data, lda_data, -20, 20, -20, 20)
}
# which lineages are most identifiable when considered as binary (A vs. not A, etc.)
# model, predict lineage
lineage_results = list()
accuracy_vetorc = c()
for (lineage in confirmed$population_lineage) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(binary_label) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(binary_label) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
lda_data <- data.frame(
Species = confirmed$binary_label,
Sample = confirmed$sample,
LD1 = species_predict$x[, 1],
LD2 = species_predict$x[, 2] # Only the first two LDs are used
)
# Store components
lineage_results[[lineage]] = list(
model = lda_model,
predictions = species_predict,
accuracy = accuracy)
urchinplot(lda_data, lda_data, -20, 20, -20, 20)
}
accuracy_vector = c()
for (lineage in confirmed$population_lineage) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(binary_label) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(binary_label) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
lda_data <- data.frame(
Species = confirmed$binary_label,
Sample = confirmed$sample,
LD1 = species_predict$x[, 1],
LD2 = species_predict$x[, 2] # Only the first two LDs are used
)
# Store components
lineage_results[[lineage]] = list(
model = lda_model,
predictions = species_predict,
accuracy = accuracy)
urchinplot(lda_data, lda_data, -20, 20, -20, 20)
}
accuracy_vector = c()
for (lineage in confirmed$population_lineage) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(binary_label) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(binary_label) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
lda_data <- data.frame(
Species = confirmed$binary_label,
Sample = confirmed$sample,
LD1 = species_predict$x[, 1],
LD2 = species_predict$x[, 2], # Only the first two LDs are used
)
# Store components
lineage_results[[lineage]] = list(
model = lda_model,
predictions = species_predict,
accuracy = accuracy)
urchinplot(lda_data, lda_data, -20, 20, -20, 20)
}
confirmed$binary_label
View(species_predict)
for (lineage in confirmed$population_lineage) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(binary_label) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(binary_label) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
accuracy
lda_data <- data.frame(
Species = confirmed$binary_label,
Sample = confirmed$sample,
LD1 = species_predict$x[, 1],
LD2 = species_predict$x[, 2], # Only the first two LDs are used
)
# Store components
lineage_results[[lineage]] = list(
model = lda_model,
predictions = species_predict,
accuracy = accuracy)
urchinplot(lda_data, lda_data, -20, 20, -20, 20)
}
species_predict$x
for (lineage in confirmed$population_lineage) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(binary_label) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(binary_label) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
lda_data <- data.frame(
Species = confirmed$binary_label,
Sample = confirmed$sample,
LD1 = species_predict$x[, 1],
LD2 = 0, # Only the first two LDs are used
)
# Store components
lineage_results[[lineage]] = list(
model = lda_model,
predictions = species_predict,
accuracy = accuracy)
urchinplot(lda_data, lda_data, -20, 20, -20, 20)
}
lda_data <- data.frame(
Species = confirmed$binary_label,
Sample = confirmed$sample,
LD1 = species_predict$x[, 1],
LD2 = 0 # Only the first two LDs are used
)
for (lineage in confirmed$population_lineage) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(binary_label) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(binary_label) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
lda_data <- data.frame(
Species = confirmed$binary_label,
Sample = confirmed$sample,
LD1 = species_predict$x[, 1],
LD2 = 0 # Only the first two LDs are used
)
# Store components
lineage_results[[lineage]] = list(
model = lda_model,
predictions = species_predict,
accuracy = accuracy)
urchinplot(lda_data, lda_data, -20, 20, -20, 20)
}
for (lineage in confirmed$population_lineage) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(binary_label) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(binary_label) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
lda_data <- data.frame(
Species = confirmed$binary_label,
Sample = confirmed$sample,
LD1 = species_predict$x[, 1]
)
# Store components
lineage_results[[lineage]] = list(
model = lda_model,
predictions = species_predict,
accuracy = accuracy)
}
for (lineage in confirmed$population_lineage) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(binary_label) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(binary_label) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
# Store components
lineage_results[[lineage]] = list(
model = lda_model,
predictions = species_predict,
accuracy = accuracy)
}
for (lineage in confirmed$population_lineage) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(binary_label) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(binary_label) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
}
# summarize success by lineage in binary classification
names(accuracy_vec) = lineages
accuracy_vec
lineages = unique(confirmed$population_lineage)
# summarize success by lineage in binary classification
names(accuracy_vec) = lineages
accuracy_vec
# summarize success by lineage in binary classification
names(accuracy_vector) = lineages
accuracy_vec
accuracy_vector
lineages
lineages = unique(confirmed$population_lineage) %>% drop_na()
lineages = unique(confirmed$population_lineage) %>% filter()
table(confirmed$population_lineage)
lineages = lineages[lineages != "",]
lineages = lineages[lineages != ""]
accuracy_vector = c()
for (lineage in lineages) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(binary_label) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(binary_label) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
}
accuracy_vector
lineages
View(lineage_train)
lineage_train[, wavelengths]
count_na(lineage_train[, wavelengths])
is.na(lineage_train[, wavelengths])
sum(is.na(lineage_train[, wavelengths])
)
X <- model.matrix(~ ., data = train |> select(-binary_label, -sample, -population_lineage))
X <- model.matrix(~ ., data = lineage_train |> select(-binary_label, -sample, -population_lineage))
X <- model.matrix(~ ., data = lineage_train |> select(-binary_label, -sample, -population_lineage))
if (any(!is.finite(lineage_train))) {
bad <- which(!is.finite(X), arr.ind = TRUE)
print("Non-finite values detected:")
print(bad)
stop("Fix non-finite values")
}
class(wavelengths)
class(nir[,wavelengths])
table(lineage_train$population_lineage)
table(lineage_test$population_lineage)
View(lineage_test)
table(confirmed$population_lineage, confirmed$sample)
barplot(confirmed$population_lineage)
hist(confirmed$population_lineage)
table(lineage_train$population_lineage)
table(lineage_test)
table(lineage_test$population_lineage)
# which lineages are most identifiable when considered as binary (A vs. not A, etc.)
# model, predict lineage
lineage_results = list()
lineages = unique(confirmed$population_lineage)
lineages = lineages[lineages != ""]
accuracy_vector = c()
for (lineage in lineages) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(population_lineage) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(population_lineage) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
}
# summarize success by lineage in binary classification
names(accuracy_vector) = lineages
accuracy_vector
lineages
View(lineage_train)
table(lineage_train$population_lineage)
table(lineage_test$population_lineage)
debug = lineage_test[lineage_test$population_lineage == "",]
View(debug)
lineage_train$specieslineage
lineages = unique(confirmed$specieslineage)
lineages = lineages[lineages != ""]
accuracy_vector = c()
lineages = lineages[lineages != ""]
accuracy_vector = c()
for (lineage in lineages) {
confirmed$binary_label = ifelse(confirmed$specieslineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(specieslineage) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(specieslineage) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
}
# summarize success by lineage in binary classification
names(accuracy_vector) = lineages
accuracy_vector
table(lineage_test$specieslineage)
table(lineage_train$specieslineage)
lineages[lineages != ""] = "ferrugineum"
accuracy_vector = c()
for (lineage in lineages) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(population_lineage) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(population_lineage) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
}
# which lineages are most identifiable when considered as binary (A vs. not A, etc.)
# model, predict lineage
lineage_results = list()
lineages = unique(confirmed$population_lineage)
lineages[lineages != ""] = "ferrugineum"
accuracy_vector = c()
for (lineage in lineages) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(population_lineage) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(population_lineage) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
}
# summarize success by lineage in binary classification
names(accuracy_vector) = lineages
accuracy_vector
table(lineage_test$population_lineage)
table(lineage_train$population_lineage)
confirmed$population_lineage[confirmed$population_lineage == "",] = "ferrugineum"
confirmed$population_lineage[confirmed$population_lineage == ""] = "ferrugineum"
# which lineages are most identifiable when considered as binary (A vs. not A, etc.)
# model, predict lineage
lineage_results = list()
lineages = unique(confirmed$population_lineage)
lineages[lineages != ""] = "ferrugineum"
confirmed$population_lineage[confirmed$population_lineage == ""] = "ferrugineum"
accuracy_vector = c()
for (lineage in lineages) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(population_lineage) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(population_lineage) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
}
# summarize success by lineage in binary classification
names(accuracy_vector) = lineages
accuracy_vector
lineages
# which lineages are most identifiable when considered as binary (A vs. not A, etc.)
# model, predict lineage
lineage_results = list()
lineages = unique(confirmed$population_lineage)
confirmed$population_lineage[confirmed$population_lineage == ""] = "ferrugineum"
accuracy_vector = c()
for (lineage in lineages) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(population_lineage) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(population_lineage) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
}
table(lineage_train$population_lineage)
table(lineage_test$population_lineage)
class(lineages)
lineages
lineages = lineages[-5]
lineages
# which lineages are most identifiable when considered as binary (A vs. not A, etc.)
# model, predict lineage
lineage_results = list()
lineages = unique(confirmed$population_lineage)
lineages = lineages[-5]
confirmed$population_lineage[confirmed$population_lineage == ""] = "ferrugineum"
accuracy_vector = c()
for (lineage in lineages) {
confirmed$binary_label = ifelse(confirmed$population_lineage == lineage, lineage, "OTHER")
lineage_train = confirmed %>% group_by(population_lineage) %>%
filter(sample != min(sample))
lineage_test = confirmed %>% group_by(population_lineage) %>%
filter(sample == min(sample))
lineage_model = lda(x = lineage_train[, wavelengths],
grouping = lineage_train$binary_label)
species_predict = MASS:::predict.lda(lineage_model, newdata = lineage_test[, wavelengths])
accuracy = mean(species_predict$class == lineage_test$binary_label)
accuracy_vector = c(accuracy_vector, accuracy)
}
# summarize success by lineage in binary classification
names(accuracy_vector) = lineages
accuracy_vector
